{% extends "spa.html" %}
{% load staticfiles %}

{% block head %}
	
{% endblock %}

{% block content %}
		<link rel="stylesheet" type="text/css" href="{% static 'visualizer/css/sidenav.css' %}">
		<link rel="stylesheet" type="text/css" href="{% static 'visualizer/css/main.css' %}">
		<link rel="stylesheet" type="text/css" href="{% static 'visualizer/css/visualization.css' %}">
		<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>

		<script src="{% static 'visualizer/js/menu.js' %}" type="text/javascript"></script>
		<script src="{% static 'visualizer/js/searchsubmit.js' %}" type="text/javascript"></script>

    	<div id="pagewrapper">
			<div id="menuwrapper">
				<div id="sidemenu" class="menutext">				
					<a href="#">About</a>
					<a href="#">Services</a>
					<a href="#">Clients</a>
					<a href="#">Contact</a>
				</div>	
			</div>
			<div id="openclosebox" class="menutext">
				<a href="javascript:void(0)" id="openclosebtn"></a>
			</div>
			<div id="main">
				<div class="querybar grid-x grid-padding-x">
					{% csrf_token %}
					<form id="sourceForm" class="small-12 medium-12 cell" type="POST" action="javascript:search()">
						<div class="grid-x grid-margin-x">
							<fieldset class="fieldset small-4 cell">
								<legend>Source</legend>
							
								<div class="input-group">
									<span class="input-group-label small-3">Type</span>
									<select id="sourceLabel"" class="small-9 input-group-field">
										<option value="" selected>*</option>
									</select>
								</div>
								<div class="input-group">
									<span class="input-group-label small-3">Name</span>
									<input type="text" id="sourceName" onkeyup="sourceNameKeyUp()"  placeholder="Name"  class="small-9 input-group-field">
								</div>									
								<div class="input-group">
									<span class="input-group-label small-3">Where</span>
									<input type="text" id="sourceProp" onkeyup="sourcePropKeyUp()" placeholder="Where"  class="small-9 input-group-field">
								</div>
							</fieldset>

							<fieldset class="fieldset small-4 cell">
								<legend>Relationship</legend>
							
								<div class="input-group">
									<span class="input-group-label small-3">Type</span>
									<select id="edgeLabel"" class="small-9 input-group-field">
										<option value="" selected>*</option>
									</select>
								</div>								
								<div class="input-group">
									<span class="input-group-label small-3">Depth</span>
									<input type="text" id="sourceProp" onkeyup="sourcePropKeyUp()" placeholder="Depth"  class="small-9 input-group-field">
								</div>
							</fieldset>

							<fieldset class="fieldset small-4 cell">
								<legend>Target</legend>
							
								<div class="input-group">
									<span class="input-group-label small-3">Type</span>
									<select id="targetLabel"" class="small-9 input-group-field">
										<option value="" selected>*</option>
									</select>
								</div>
								<div class="input-group">
									<span class="input-group-label small-3">Name</span>
									<input type="text" id="sourceName" onkeyup="sourceNameKeyUp()"  placeholder="Name"  class="small-9 input-group-field">
								</div>									
								<div class="input-group">
									<span class="input-group-label small-3">Where</span>
									<input type="text" id="sourceProp" onkeyup="sourcePropKeyUp()" placeholder="Where"  class="small-9 input-group-field">
								</div>						
							</fieldset>
						</div>
						<div class="grid-x cell">
							<input type="submit" class="button">
						</div>
					</form>
					
				</div>
				
				<div id="drawingpane" tabindex="0">
					<div id="detailcardwrapper"></div>
					<div id="viewcontrols">
						<div onclick="restartLayout()">
							<i id="restartIcon" class="fas fa-sync-alt viewcontrol"></i>
						</div>
						<div id="pausePlayBtn" onclick="playLayout()">
							<i id="pausePlayIcon" class="fas fa-play viewcontrol"></i>
						</div>
						<div onclick="showMenu()">
							<i id="menuIcon" class="fas fa-angle-down viewcontrol viewcontrol-right"></i>
						</div>
					</div>
				</div>
			</div>
		</div>
		
{% endblock %}

{% block tail %}	
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="{% static 'visualizer/js/draw-d3.js' %}" type="text/javascript"></script>
	<script src="{% static 'visualizer/js/search.js' %}" type="text/javascript"></script>
	<script>
		//var getAllUrl = "{% static 'visualizer/json/testdata.json' %}";
		//var getAllUrl = "/api/getall";
		var iconmappings;
		$.getJSON("{% static 'visualizer/json/labelicons.json' %}", function(data) {
		        iconmappings = new IconMappings(data);
		    });
		$.getJSON("/api/nodes/labels", function(data) {
		        for (var i = 0; i < data.length; ++i) {
					addOption(document.getElementById("sourceLabel"), data[i], ":" + data[i])
				}
				for (var i = 0; i < data.length; ++i) {
					addOption(document.getElementById("targetLabel"), data[i], ":" + data[i])
				}
		    });
		$.getJSON("/api/edges/labels", function(data) {
		        for (var i = 0; i < data.length; ++i) {
					addOption(document.getElementById("edgeLabel"), data[i], ":" + data[i])
				}
		    });
		//var 
	</script>
	<script>
		closeNav();
		drawGraph('drawingpane');
	</script>
{% endblock %}